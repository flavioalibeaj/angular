<form [formGroup]="formGroup()" [class]="formClass()">
  @for (input of formModel(); track input) {
  @switch (input.fieldType) {
  @case ('text') {
  @let errorMessage = handleErrors(input.fieldName) | async;

  <mat-form-field [class]="input.inputClass">
    <mat-label> {{input.label | translate}} </mat-label>
    <input matInput type="text" [formControlName]="input.fieldName" [readonly]="input.readonly" />
    @if (input.prefixIcon) {
    <mat-icon matPrefix>{{input.prefixIcon}}</mat-icon>
    }
    @if (input.suffixIcon) {
    <mat-icon matSuffix>{{input.suffixIcon}}</mat-icon>
    }
    @if (input.hint) {
    <mat-hint>{{input.hint}}</mat-hint>
    }
    @if (!input.readonly && input.clearFieldValue && formGroup().get(input.fieldName)?.value) {
    <button matSuffix type="button" mat-icon-button aria-label="Clear" (click)="clearInputValue(input, $event)">
      <mat-icon>close</mat-icon>
    </button>
    }
    @if(errorMessage){
    <mat-error>{{errorMessage}}</mat-error>
    }
  </mat-form-field>
  }
  @case ('textArea') {
  @let errorMessage = handleErrors(input.fieldName) | async;

  <mat-form-field [class]="input.inputClass">
    <mat-label> {{input.label | translate}} </mat-label>
    <textarea matInput type="text" [formControlName]="input.fieldName" [readonly]="input.readonly"></textarea>
    @if (input.hint) {
    <mat-hint>{{input.hint}}</mat-hint>
    }
    @if (!input.readonly && input.clearFieldValue && formGroup().get(input.fieldName)?.value) {
    <button matSuffix type="button" mat-icon-button aria-label="Clear" (click)="clearInputValue(input, $event)">
      <mat-icon>close</mat-icon>
    </button>
    }
    @if(errorMessage){
    <mat-error>{{errorMessage}}</mat-error>
    }
  </mat-form-field>
  }
  @case ('number') {
  @let errorMessage = handleErrors(input.fieldName) | async;

  <mat-form-field [class]="input.inputClass">
    <mat-label> {{input.label | translate}} </mat-label>
    <input matInput type="number" inputmode="numeric" pattern="[0-9]*" [formControlName]="input.fieldName"
      [readonly]="input.readonly" />
    @if (input.prefixIcon) {
    <mat-icon matPrefix>{{input.prefixIcon}}</mat-icon>
    }
    @if (input.suffixIcon) {
    <mat-icon matSuffix>{{input.suffixIcon}}</mat-icon>
    }
    @if (input.hint) {
    <mat-hint>{{input.hint}}</mat-hint>
    }
    @if (!input.readonly && input.clearFieldValue && formGroup().get(input.fieldName)?.value) {
    <button matSuffix type="button" mat-icon-button aria-label="Clear" (click)="clearInputValue(input, $event)">
      <mat-icon>close</mat-icon>
    </button>
    }
    @if(errorMessage){
    <mat-error>{{errorMessage}}</mat-error>
    }
  </mat-form-field>
  }
  @case ('password') {
  <ng-container [ngTemplateOutlet]="password" [ngTemplateOutletContext]="{input}" />
  }
  @case ('datePicker') {
  @let errorMessage = handleErrors(input.fieldName) | async;

  <mat-form-field [class]="input.inputClass">
    <mat-label> {{input.label | translate}} </mat-label>
    <input matInput [min]="input.minDate" [max]="input.maxDate" [matDatepicker]="picker"
      [formControlName]="input.fieldName" [readonly]="input.readonly">
    <mat-datepicker-toggle matIconSuffix [for]="picker" [disabled]="input.readonly" />
    <mat-datepicker #picker />
    @if (input.hint) {
    <mat-hint>{{input.hint}}</mat-hint>
    }
    @if (!input.readonly && input.clearFieldValue && formGroup().get(input.fieldName)?.value) {
    <button matSuffix type="button" mat-icon-button aria-label="Clear" (click)="clearInputValue(input, $event)">
      <mat-icon>close</mat-icon>
    </button>
    }
    @if(errorMessage){
    <mat-error>{{errorMessage}}</mat-error>
    }
  </mat-form-field>
  }
  @case('dateRange') {
  @let errorMessage = handleErrors(input.fieldName) | async;
  @let isClearValueShown = !input.readonly && input.clearFieldValue && formGroup().get(input.fieldName)?.value &&
  formGroup().get(input.dateRangeSecondFieldName ?? '')?.value;

  <mat-form-field [class]="input.inputClass">
    <mat-label> {{input.label | translate}} </mat-label>
    <mat-date-range-input [min]="input.minDate" [max]="input.maxDate" [rangePicker]="picker">
      <input matStartDate [formControlName]="input.fieldName" [readonly]="input.readonly">
      <input matEndDate [formControlName]="input.dateRangeSecondFieldName ?? ''" [readonly]="input.readonly">
    </mat-date-range-input>
    <mat-datepicker-toggle matIconSuffix [for]="picker" [disabled]="input.readonly" />
    <mat-date-range-picker #picker />
    @if (input.hint) {
    <mat-hint>{{input.hint}}</mat-hint>
    }
    @if (isClearValueShown) {
    <button matSuffix type="button" mat-icon-button aria-label="Clear" (click)="clearInputValue(input, $event)">
      <mat-icon>close</mat-icon>
    </button>
    }
    @if(errorMessage){
    <mat-error>{{errorMessage}}</mat-error>
    }
  </mat-form-field>
  }
  @case ('radio') {
  @let errorMessage = handleErrors(input.fieldName) | async;

  <label [id]="'radio-group-label'+input.label">{{input.label | translate}}</label>
  <mat-radio-group [attr.aria-labelledby]="'radio-group-label'+input.label" [class]="input.inputClass"
    [formControlName]="input.fieldName">
    @for (opt of input.radioOptions; track opt) {
    <mat-radio-button [value]="opt.key" [disabled]="input.readonly">{{opt.value}}</mat-radio-button>
    }
  </mat-radio-group>
  @if (input.hint) {
  <mat-hint>{{input.hint}}</mat-hint>
  }
  @if(errorMessage){
  <mat-error>{{errorMessage}}</mat-error>
  }
  }
  @case ('color') {
  @let errorMessage = handleErrors(input.fieldName) | async;

  <mat-form-field [class]="input.inputClass">
    <mat-label> {{input.label | translate}} </mat-label>
    <input type="text" matInput readonly [formControlName]="input.fieldName"
      (click)="colorInput.click(); $event.stopImmediatePropagation()" />
    @if (!input.readonly) {
    <button mat-icon-button matSuffix (click)="colorInput.click(); $event.stopPropagation()">
      <mat-icon>palette</mat-icon>
    </button>
    }
    @if (input.hint) {
    <mat-hint>{{input.hint}}</mat-hint>
    }
    @if(errorMessage){
    <mat-error>{{errorMessage}}</mat-error>
    }
  </mat-form-field>
  <input #colorInput style="visibility: hidden; height: 0; width: 0;" type="color"
    [value]="input.fieldValue ?? blackColor" (change)="onColorChange($event, input.fieldName)">
  }
  @case ('checkbox') {
  @let errorMessage = handleErrors(input.fieldName) | async;

  <mat-checkbox [class]="input.inputClass" [formControlName]="input.fieldName">
    {{input.label | translate}}</mat-checkbox>
  @if (input.hint) {
  <mat-hint>{{input.hint}}</mat-hint>
  }
  @if(errorMessage){
  <mat-error>{{errorMessage}}</mat-error>
  }
  }
  @case ('slideToggle') {
  @let errorMessage = handleErrors(input.fieldName) | async;

  <mat-slide-toggle [class]="input.inputClass" [formControlName]="input.fieldName">
    {{input.label | translate}}
  </mat-slide-toggle>
  @if (input.hint) {
  <mat-hint>{{input.hint}}</mat-hint>
  }
  @if(errorMessage){
  <mat-error>{{errorMessage}}</mat-error>
  }
  }
  @case ('file') {}
  @case ('slider') {}
  @case ('timePicker') {}
  @case ('chips') {}
  }
  }

  <ng-template #password let-input="input">
    @let errorMessage = handleErrors(input.fieldName) | async;
    <mat-form-field [class]="input.inputClass">
      <mat-label> {{input.label | translate}} </mat-label>
      <input matInput [type]="hidePassword ? 'password' : 'text'" [formControlName]="input.fieldName">
      <button mat-icon-button matSuffix type="button" (click)="toggleVisibility($event)"
        [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hidePassword">
        <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
      </button>
      @if (errorMessage) {
      <mat-error>{{errorMessage}}</mat-error>
      }
    </mat-form-field>
  </ng-template>

  <mat-divider />
  <div class="d-flex align-items-center my-3 justify-content-end" [class]="actionsClass()">
    @if(contentProjection()){
    <ng-content />
    }

    @if (!hideCancelBtn()) {
    <button mat-raised-button [disabled]="!formGroup().valid" color="warn">
      <mat-icon>{{cancelButtonIcon()}}</mat-icon>
      {{cancelButtonText() | translate}}
    </button>
    }
    @if (!hideSubmitBtn()) {
    <button mat-raised-button type="submit" color="primary" [disabled]="!formGroup().valid"
      [class]="submitButtonClass()" (click)="onSubmit()">
      <mat-icon> {{submitButtonIcon()}} </mat-icon>
      {{submitButtonText() | translate}}
    </button>
    }
  </div>
</form>